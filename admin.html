<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin-Bereich - WLAN Anfragen</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b1220;color:#e6eef8;padding:20px;}
    .card{background:#0f1724;padding:18px;border-radius:12px;max-width:640px;margin:24px auto;}
    button{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:700;margin:2px;}
    .allow{background:#27ae60;color:white;}
    .deny{background:#e74c3c;color:white;}
    .logout{background:#172a4d;color:#e6eef8;margin-top:12px;}
  </style>
</head>
<body>
  <div class="card" id="loginCard">
    <h2>🔐 Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Admin Passwort" style="padding:8px;border-radius:6px;width:80%;"><br>
    <button onclick="checkLogin()">Login</button>
    <p id="loginStatus"></p>
  </div>

  <div class="card" id="adminCard" style="display:none;">
    <h2>📋 Offene WLAN-Anfragen</h2>
    <div id="list">Lade Anfragen...</div>
    <button class="logout" onclick="logout()">Abmelden</button>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.27.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.27.0/firebase-database-compat.js"></script>

  <script>
    // ==== Firebase-Konfiguration ====
    const firebaseConfig = {
      apiKey: "AIzaSyDhTdfO1__2zuc5g7l1NWLTpANtKyJLXp8",
      authDomain: "hotspot-9bd24.firebaseapp.com",
      databaseURL: "https://hotspot-9bd24-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hotspot-9bd24",
      storageBucket: "hotspot-9bd24.appspot.com",
      messagingSenderId: "308452292161",
      appId: "1:308452292161:web:d84312eb16f6eaef4038c0",
      measurementId: "G-G8R267J80E"
    };
    // ======================================

    // Dein Admin-Passwort hier einstellen 🔒
    const ADMIN_PASSWORD = "meinpasswort";

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const loginCard = document.getElementById("loginCard");
    const adminCard = document.getElementById("adminCard");
    const loginStatus = document.getElementById("loginStatus");
    const list = document.getElementById("list");

    function checkLogin() {
      const input = document.getElementById("adminPass").value;
      if (input === ADMIN_PASSWORD) {
        loginCard.style.display = "none";
        adminCard.style.display = "block";
        loadRequests();
      } else {
        loginStatus.textContent = "❌ Falsches Passwort";
      }
    }

    function logout() {
      adminCard.style.display = "none";
      loginCard.style.display = "block";
      document.getElementById("adminPass").value = "";
    }

    function loadRequests() {
      list.textContent = "Lade...";
      const ref = db.ref("requests");
      ref.on("value", snap => {
        const data = snap.val();
        list.innerHTML = "";
        console.log("📡 Daten erhalten:", data);
        if (!data) {
          list.innerHTML = "<p>Keine offenen Anfragen 🙌</p>";
          return;
        }
        for (const [id, req] of Object.entries(data)) {
          const div = document.createElement("div");
          div.style.marginBottom = "10px";
          div.style.padding = "10px";
          div.style.border = "1px solid #1f2b3f";
          div.style.borderRadius = "8px";
          div.innerHTML = `
            <strong>${req.name}</strong><br>
            <small>${new Date(req.ts).toLocaleString()}</small><br>
            <span>Status: ${req.status}</span><br>
            <button class="allow" onclick="updateStatus('${id}','allowed')">Zulassen</button>
            <button class="deny" onclick="updateStatus('${id}','denied')">Ablehnen</button>
          `;
          list.appendChild(div);
        }
      });
    }

    function updateStatus(id, status) {
      db.ref("requests/" + id + "/status").set(status);
    }
  </script>
</body>
</html>