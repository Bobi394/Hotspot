<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Login</title>
<style>
  body { font-family: sans-serif; background:#0b1220; color:#e6eef8; margin:0; padding:20px; }
  .card { background:#0f1724; padding:20px; border-radius:12px; max-width:600px; margin:20px auto; }
  input[type="password"] { padding:10px; border-radius:8px; border:1px solid #233; width:60%; background:#071229; color:#e6eef8; }
  button { padding:8px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:700; margin-left:6px; }
  .btn-login { background:#3b82f6; color:#fff; }
  .btn-logout { background:#172a4d; color:#e6eef8; margin-top:12px; }
  .item { background:#112233; border:1px solid #1f2b3f; border-radius:8px; padding:12px; margin-bottom:10px; }
  .allow { background:#27ae60; color:white; margin-right:8px; }
  .deny { background:#e74c3c; color:white; }
  .empty { color:#9fb0c8; padding:12px; text-align:center; }
</style>
</head>
<body>

<div id="loginCard" class="card">
  <h2>üîê Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Passwort">
  <button class="btn-login" onclick="login()">Anmelden</button>
  <p id="loginMsg" style="color:#f88; margin-top:10px;"></p>
</div>

<div id="adminCard" class="card" style="display:none;">
  <h2>üì• Offene WLAN-Anfragen</h2>
  <div id="list"><div class="empty">Warte auf Anfragen‚Ä¶</div></div>
  <button class="btn-logout" onclick="logout()">Abmelden</button>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.27.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.27.0/firebase-database-compat.js"></script>

<script>
  // ==================== FIREBASE ====================
  const firebaseConfig = {
    apiKey: "AIzaSyDhTdfO1__2zuc5g7l1NWLTpANtKyJLXp8",
    authDomain: "hotspot-9bd24.firebaseapp.com",
    databaseURL: "https://hotspot-9bd24-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "hotspot-9bd24",
    storageBucket: "hotspot-9bd24.appspot.com",
    messagingSenderId: "308452292161",
    appId: "1:308452292161:web:d84312eb16f6eaef4038c0",
    measurementId: "G-G8R267J80E"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ==================== ADMIN PASSWORT ====================
  const ADMIN_PASSWORD = "Oskar123";

  // ==================== UI ELEMENTE ====================
  const loginCard = document.getElementById('loginCard');
  const adminCard = document.getElementById('adminCard');
  const adminPassInput = document.getElementById('adminPass');
  const loginMsg = document.getElementById('loginMsg');
  const listEl = document.getElementById('list');

  let requestsRef = null;

  // ==================== LOGIN ====================
  function login() {
    const val = adminPassInput.value;
    if(val === ADMIN_PASSWORD){
      loginMsg.textContent = '';
      loginCard.style.display = 'none';
      adminCard.style.display = 'block';
      loadRequests();
    } else {
      loginMsg.textContent = '‚ùå Falsches Passwort';
    }
  }

  function logout() {
    if(requestsRef) requestsRef.off();
    adminPassInput.value = '';
    adminCard.style.display = 'none';
    loginCard.style.display = 'block';
  }

  // ==================== FIREBASE REQUESTS ====================
  function loadRequests() {
    listEl.innerHTML = '<div class="empty">Warte auf Anfragen‚Ä¶</div>';
    requestsRef = db.ref('requests');
    requestsRef.on('value', snapshot => {
      const data = snapshot.val();
      renderRequests(data);
    });
  }

  function renderRequests(data) {
    listEl.innerHTML = '';
    if(!data){
      listEl.innerHTML = '<div class="empty">Keine Anfragen üôå</div>';
      return;
    }
    for(const [id, req] of Object.entries(data)){
      const div = document.createElement('div');
      div.className = 'item';
      const name = req.name || 'Unbekannt';
      const ts = req.ts ? new Date(req.ts).toLocaleString() : '‚Äî';
      const status = req.status || 'pending';
      div.innerHTML = `
        <strong>${name}</strong> <small>${ts}</small><br>
        Status: ${status}<br>
        <button class="allow" onclick="updateStatus('${id}','allowed')">Zulassen ‚úÖ</button>
        <button class="deny" onclick="updateStatus('${id}','denied')">Ablehnen ‚ùå</button>
      `;
      listEl.appendChild(div);
    }
  }

  function updateStatus(id, status){
    db.ref('requests/' + id + '/status').set(status);
  }
</script>

</body>
</html>